# BridgeSpeak ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆæ›¸ï¼ˆMVP ç‰ˆï¼‰

## ðŸ“‹ ç›®æ¬¡

1. [MVP æ¦‚è¦](#mvp-æ¦‚è¦)
2. [ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ](#ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ)
3. [ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©](#ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©)
4. [ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é †åº](#ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é †åº)
5. [å®Ÿè£…ã‚¬ã‚¤ãƒ‰](#å®Ÿè£…ã‚¬ã‚¤ãƒ‰)

---

## MVP æ¦‚è¦

### å¯¾è±¡æ©Ÿèƒ½

**âœ… å®Ÿè£…ã™ã‚‹æ©Ÿèƒ½**

1. **ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ãƒ»ãƒ­ã‚°ã‚¤ãƒ³**ï¼ˆAWS Cognitoï¼‰
2. **AI Agent ä½œæˆ**
   - åå‰ã€èª¬æ˜Žã€ã‚¢ãƒã‚¿ãƒ¼è¨­å®š
   - æŒ¯ã‚‹èˆžã„é¸æŠžï¼ˆassistant / creative / analyticalï¼‰
   - LLM ãƒ¢ãƒ‡ãƒ«é¸æŠžï¼ˆgpt-4o / claude-3.5-sonnet / gemini-proï¼‰
3. **ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½**
   - AI Agent ã¨ã® 1 å¯¾ 1 ãƒãƒ£ãƒƒãƒˆ
   - ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€å—ä¿¡
   - ä¼šè©±å±¥æ­´è¡¨ç¤º
   - AI å‡¦ç†å±¥æ­´ã®è¨˜éŒ²

**âŒ MVP ã§ã¯å®Ÿè£…ã—ãªã„æ©Ÿèƒ½**

- ãƒ¦ãƒ¼ã‚¶ãƒ¼é–“ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°ï¼ˆå‹é”æ©Ÿèƒ½ï¼‰
- æ—¢èª­ç®¡ç†
- ã‚°ãƒ«ãƒ¼ãƒ—ãƒãƒ£ãƒƒãƒˆ
- è¤‡é›‘ãªãƒšãƒ«ã‚½ãƒŠè¨­å®šï¼ˆåˆ¥ãƒ†ãƒ¼ãƒ–ãƒ«ä¸è¦ï¼‰
- çµ±è¨ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
- ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ­ãƒ¼

```
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²/ãƒ­ã‚°ã‚¤ãƒ³ï¼ˆCognitoï¼‰
   â†“
2. AI Agent ä½œæˆ
   - åå‰: "ãƒžã‚¤ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ"
   - æŒ¯ã‚‹èˆžã„: assistantï¼ˆè¦ªåˆ‡ã§ä¸å¯§ï¼‰
   - ãƒ¢ãƒ‡ãƒ«: gpt-4o
   â†“
3. ãƒãƒ£ãƒƒãƒˆç”»é¢
   - AI Agent ã¨ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ä¼šè©±
   - ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å±¥æ­´ã‚’è¡¨ç¤º
```

---

## ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend      â”‚
â”‚   (Next.js)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ HTTP/REST
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Backend-go            â”‚ â† ãƒ‡ãƒ¼ã‚¿ç®¡ç†ã®å˜ä¸€çª“å£
â”‚   (API Gateway)         â”‚
â”‚                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ User Service    â”‚   â”‚
â”‚  â”‚ AI Agent Svc    â”‚   â”‚
â”‚  â”‚ Chat Service    â”‚   â”‚
â”‚  â”‚ MCP Service     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   PostgreSQL    â”‚
â”‚  (8ãƒ†ãƒ¼ãƒ–ãƒ«)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†‘
         â”‚ å†…éƒ¨ HTTP
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend-python  â”‚ â† AI å‡¦ç†å°‚ç”¨
â”‚ (AI Engine)     â”‚   (DB ã‚¢ã‚¯ã‚»ã‚¹ãªã—)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©

### MVP ã§ä½¿ç”¨ã™ã‚‹ 8 ãƒ†ãƒ¼ãƒ–ãƒ«

| #   | ãƒ†ãƒ¼ãƒ–ãƒ«å               | èª¬æ˜Ž                       | é‡è¦åº¦        |
| --- | ------------------------ | -------------------------- | ------------- |
| 1   | `users`                  | ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±               | ðŸ”´ å¿…é ˆ       |
| 2   | `ai_agents`              | AI Agentï¼ˆãƒšãƒ«ã‚½ãƒŠçµ±åˆï¼‰   | ðŸ”´ å¿…é ˆ       |
| 3   | `conversations`          | ä¼šè©±ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ â†” AI ã®ã¿ï¼‰ | ðŸ”´ å¿…é ˆ       |
| 4   | `messages`               | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸                 | ðŸ”´ å¿…é ˆ       |
| 5   | `ai_chat_sessions`       | AI å‡¦ç†å±¥æ­´                | ðŸŸ¡ æŽ¨å¥¨       |
| 6   | `ai_tool_usage`          | ãƒ„ãƒ¼ãƒ«ä½¿ç”¨å±¥æ­´             | ðŸŸ¡ æŽ¨å¥¨       |
| 7   | `mcp_servers`            | MCP ã‚µãƒ¼ãƒãƒ¼è¨­å®š           | ðŸŸ¢ ã‚ªãƒ—ã‚·ãƒ§ãƒ³ |
| 8   | `mcp_server_credentials` | MCP èªè¨¼æƒ…å ±               | ðŸŸ¢ ã‚ªãƒ—ã‚·ãƒ§ãƒ³ |

---

### 1. usersï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‰

**ç›®çš„**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®åŸºæœ¬æƒ…å ±ã‚’ç®¡ç†

```sql
CREATE TABLE users (
    -- ãƒ—ãƒ©ã‚¤ãƒžãƒªã‚­ãƒ¼
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),

    -- AWS Cognitoé€£æº
    cognito_user_id VARCHAR(255) UNIQUE NOT NULL,

    -- åŸºæœ¬æƒ…å ±
    email VARCHAR(255) UNIQUE NOT NULL,
    display_name VARCHAR(255) NOT NULL,
    avatar_url TEXT,

    -- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
    status VARCHAR(50) NOT NULL DEFAULT 'active',
    -- active: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–
    -- inactive: éžã‚¢ã‚¯ãƒ†ã‚£ãƒ–
    -- deleted: å‰Šé™¤æ¸ˆã¿ï¼ˆã‚½ãƒ•ãƒˆãƒ‡ãƒªãƒ¼ãƒˆï¼‰

    -- ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    last_active_at TIMESTAMP,

    -- åˆ¶ç´„
    CONSTRAINT chk_users_status CHECK (status IN ('active', 'inactive', 'deleted'))
);

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_users_cognito_user_id ON users(cognito_user_id);
CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_users_status ON users(status) WHERE status = 'active';

-- ãƒˆãƒªã‚¬ãƒ¼
CREATE TRIGGER update_users_updated_at BEFORE UPDATE ON users
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();
```

---

### 2. ai_agentsï¼ˆAI Agent - ãƒšãƒ«ã‚½ãƒŠçµ±åˆç‰ˆï¼‰

**ç›®çš„**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä½œæˆã—ãŸ AI Agent ã®æƒ…å ±ã¨ãƒšãƒ«ã‚½ãƒŠè¨­å®š

**é‡è¦**: MVP ã§ã¯ `ai_personas` ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œã‚‰ãšã€ã™ã¹ã¦ `ai_agents` ã«çµ±åˆ

```sql
CREATE TABLE ai_agents (
    -- ãƒ—ãƒ©ã‚¤ãƒžãƒªã‚­ãƒ¼
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),

    -- æ‰€æœ‰è€…ï¼ˆå¿…é ˆï¼‰
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,

    -- AI Agent åŸºæœ¬æƒ…å ±
    name VARCHAR(255) NOT NULL,
    description TEXT,
    avatar_url TEXT,

    -- === ãƒšãƒ«ã‚½ãƒŠè¨­å®šï¼ˆçµ±åˆï¼‰ ===

    -- æŒ¯ã‚‹èˆžã„ã‚¿ã‚¤ãƒ—
    persona_type VARCHAR(50) NOT NULL DEFAULT 'assistant',
    -- assistant: è¦ªåˆ‡ã§ä¸å¯§ãªã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
    -- creative: å‰µé€ çš„ã§ç™ºæƒ³è±Šã‹ãªå¯¾è©±
    -- analytical: è«–ç†çš„ã§åˆ†æžçš„ãªå¯¾è©±

    -- LLM è¨­å®š
    provider VARCHAR(50) NOT NULL DEFAULT 'openai',
    -- openai, anthropic, google
    model VARCHAR(100) NOT NULL DEFAULT 'gpt-4o',
    temperature DECIMAL(3, 2) NOT NULL DEFAULT 0.7,
    max_tokens INTEGER NOT NULL DEFAULT 2000,

    -- ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
    system_prompt TEXT,
    -- NULLã®å ´åˆã€persona_typeã«åŸºã¥ã„ã¦Backend-goãŒè‡ªå‹•ç”Ÿæˆ

    -- ãƒ„ãƒ¼ãƒ«è¨­å®š
    tools_enabled BOOLEAN DEFAULT true,
    -- trueã®å ´åˆã€åŸºæœ¬ãƒ„ãƒ¼ãƒ«ï¼ˆæ—¥æ™‚ã€è¨ˆç®—ãªã©ï¼‰ã‚’åˆ©ç”¨å¯èƒ½

    -- === çµ‚äº† ===

    -- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
    is_active BOOLEAN DEFAULT true,

    -- çµ±è¨ˆæƒ…å ±
    message_count INTEGER DEFAULT 0,
    last_chat_at TIMESTAMP,

    -- ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,

    -- åˆ¶ç´„
    CONSTRAINT chk_persona_type CHECK (persona_type IN ('assistant', 'creative', 'analytical')),
    CONSTRAINT chk_provider CHECK (provider IN ('openai', 'anthropic', 'google')),
    CONSTRAINT chk_temperature CHECK (temperature >= 0 AND temperature <= 2),
    CONSTRAINT chk_max_tokens CHECK (max_tokens >= 100 AND max_tokens <= 8000)
);

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_ai_agents_user ON ai_agents(user_id, is_active);
CREATE INDEX idx_ai_agents_active ON ai_agents(is_active) WHERE is_active = true;
CREATE INDEX idx_ai_agents_last_chat ON ai_agents(user_id, last_chat_at DESC NULLS LAST);

-- ãƒˆãƒªã‚¬ãƒ¼
CREATE TRIGGER update_ai_agents_updated_at BEFORE UPDATE ON ai_agents
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

-- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å´ã§ç®¡ç†ï¼‰
-- assistant: "ã‚ãªãŸã¯è¦ªåˆ‡ã§ä¸å¯§ãªã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•ã«åˆ†ã‹ã‚Šã‚„ã™ãç­”ãˆã¦ãã ã•ã„ã€‚"
-- creative: "ã‚ãªãŸã¯å‰µé€ çš„ã§ç™ºæƒ³è±Šã‹ãªã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚æ–°ã—ã„ã‚¢ã‚¤ãƒ‡ã‚¢ã‚„è¦–ç‚¹ã‚’æä¾›ã—ã¦ãã ã•ã„ã€‚"
-- analytical: "ã‚ãªãŸã¯è«–ç†çš„ã§åˆ†æžçš„ãªã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚ãƒ‡ãƒ¼ã‚¿ã¨äº‹å®Ÿã«åŸºã¥ã„ã¦å›žç­”ã—ã¦ãã ã•ã„ã€‚"
```

---

### 3. conversationsï¼ˆä¼šè©± - ã‚·ãƒ³ãƒ—ãƒ«ç‰ˆï¼‰

**ç›®çš„**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ AI Agent ã®ä¼šè©±ã‚’ç®¡ç†

**MVP ã®åˆ¶ç´„**: å¸¸ã« `user â†” ai_agent` ã® 1 å¯¾ 1 ä¼šè©±ã®ã¿

```sql
CREATE TABLE conversations (
    -- ãƒ—ãƒ©ã‚¤ãƒžãƒªã‚­ãƒ¼
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),

    -- ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆå¿…é ˆï¼‰
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,

    -- AI Agentï¼ˆå¿…é ˆï¼‰
    ai_agent_id UUID NOT NULL REFERENCES ai_agents(id) ON DELETE CASCADE,

    -- çµ±è¨ˆæƒ…å ±
    message_count INTEGER DEFAULT 0,
    last_message_at TIMESTAMP,

    -- ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,

    -- åˆ¶ç´„ï¼š1ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ»1AI Agentã«ã¤ã1ã¤ã®ä¼šè©±
    CONSTRAINT unique_user_agent_conversation UNIQUE(user_id, ai_agent_id)
);

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_conversations_user ON conversations(user_id, last_message_at DESC NULLS LAST);
CREATE INDEX idx_conversations_agent ON conversations(ai_agent_id);

-- ãƒˆãƒªã‚¬ãƒ¼
CREATE TRIGGER update_conversations_updated_at BEFORE UPDATE ON conversations
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();
```

---

### 4. messagesï¼ˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼‰

**ç›®çš„**: ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä¿å­˜

```sql
CREATE TABLE messages (
    -- ãƒ—ãƒ©ã‚¤ãƒžãƒªã‚­ãƒ¼
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),

    -- ä¼šè©±
    conversation_id UUID NOT NULL REFERENCES conversations(id) ON DELETE CASCADE,

    -- é€ä¿¡è€…ã‚¿ã‚¤ãƒ—
    sender_type VARCHAR(20) NOT NULL,
    -- user: ãƒ¦ãƒ¼ã‚¶ãƒ¼
    -- ai: AI Agent

    -- é€ä¿¡è€…ID
    sender_id UUID NOT NULL,
    -- sender_type='user' ãªã‚‰ users.id
    -- sender_type='ai' ãªã‚‰ ai_agents.id

    -- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹
    content TEXT NOT NULL,

    -- AIé–¢é€£ï¼ˆsender_type='ai'ã®å ´åˆï¼‰
    ai_session_id UUID REFERENCES ai_chat_sessions(id) ON DELETE SET NULL,

    -- ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,

    -- åˆ¶ç´„
    CONSTRAINT chk_sender_type CHECK (sender_type IN ('user', 'ai'))
);

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_messages_conversation ON messages(conversation_id, created_at DESC);
CREATE INDEX idx_messages_sender ON messages(sender_type, sender_id);
CREATE INDEX idx_messages_ai_session ON messages(ai_session_id);

-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡æ™‚ã«conversationsã‚’æ›´æ–°
CREATE OR REPLACE FUNCTION update_conversation_on_message()
RETURNS TRIGGER AS $$
BEGIN
    UPDATE conversations
    SET
        last_message_at = NEW.created_at,
        message_count = message_count + 1,
        updated_at = CURRENT_TIMESTAMP
    WHERE id = NEW.conversation_id;

    -- AI Agentã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚«ã‚¦ãƒ³ãƒˆã‚‚æ›´æ–°
    IF NEW.sender_type = 'ai' THEN
        UPDATE ai_agents
        SET
            message_count = message_count + 1,
            last_chat_at = NEW.created_at,
            updated_at = CURRENT_TIMESTAMP
        WHERE id = NEW.sender_id;
    END IF;

    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trigger_update_conversation_on_message
AFTER INSERT ON messages
FOR EACH ROW EXECUTE FUNCTION update_conversation_on_message();
```

---

### 5. ai_chat_sessionsï¼ˆAI å‡¦ç†ã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼‰

**ç›®çš„**: AI å‡¦ç†ã®å®Ÿè¡Œå±¥æ­´ã‚’è¨˜éŒ²ï¼ˆåˆ†æžãƒ»ãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰

```sql
CREATE TABLE ai_chat_sessions (
    -- ãƒ—ãƒ©ã‚¤ãƒžãƒªã‚­ãƒ¼
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),

    -- é–¢é€£
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    conversation_id UUID NOT NULL REFERENCES conversations(id) ON DELETE CASCADE,
    ai_agent_id UUID NOT NULL REFERENCES ai_agents(id) ON DELETE CASCADE,
    message_id UUID REFERENCES messages(id) ON DELETE SET NULL,

    -- AIè¨­å®šï¼ˆã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆï¼‰
    provider VARCHAR(50) NOT NULL,
    model VARCHAR(100) NOT NULL,
    persona VARCHAR(50) NOT NULL,
    temperature DECIMAL(3, 2) NOT NULL,

    -- ãƒˆãƒ¼ã‚¯ãƒ³ä½¿ç”¨é‡
    tokens_prompt INTEGER,
    tokens_completion INTEGER,
    tokens_total INTEGER,

    -- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹
    processing_time_ms INTEGER,
    tools_used INTEGER DEFAULT 0,

    -- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
    status VARCHAR(50) NOT NULL DEFAULT 'processing',
    -- processing: å‡¦ç†ä¸­
    -- completed: å®Œäº†
    -- failed: å¤±æ•—

    error_message TEXT,

    -- ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
    started_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    completed_at TIMESTAMP,

    -- åˆ¶ç´„
    CONSTRAINT chk_session_status CHECK (status IN ('processing', 'completed', 'failed'))
);

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_ai_sessions_user ON ai_chat_sessions(user_id, started_at DESC);
CREATE INDEX idx_ai_sessions_conversation ON ai_chat_sessions(conversation_id);
CREATE INDEX idx_ai_sessions_agent ON ai_chat_sessions(ai_agent_id);
CREATE INDEX idx_ai_sessions_status ON ai_chat_sessions(status) WHERE status = 'processing';
```

---

### 6. ai_tool_usageï¼ˆãƒ„ãƒ¼ãƒ«ä½¿ç”¨å±¥æ­´ï¼‰

**ç›®çš„**: AI ãŒä½¿ç”¨ã—ãŸãƒ„ãƒ¼ãƒ«ã®å®Ÿè¡Œå±¥æ­´

```sql
CREATE TABLE ai_tool_usage (
    -- ãƒ—ãƒ©ã‚¤ãƒžãƒªã‚­ãƒ¼
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),

    -- é–¢é€£
    session_id UUID NOT NULL REFERENCES ai_chat_sessions(id) ON DELETE CASCADE,

    -- ãƒ„ãƒ¼ãƒ«æƒ…å ±
    tool_name VARCHAR(255) NOT NULL,
    tool_category VARCHAR(100) DEFAULT 'basic',
    -- basic: åŸºæœ¬ãƒ„ãƒ¼ãƒ«ï¼ˆæ—¥æ™‚ã€è¨ˆç®—ãªã©ï¼‰
    -- mcp: MCPãƒ„ãƒ¼ãƒ«

    -- å®Ÿè¡Œæƒ…å ±
    input_data JSONB NOT NULL,
    output_data TEXT,

    -- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
    status VARCHAR(50) NOT NULL,
    -- completed: å®Œäº†
    -- failed: å¤±æ•—

    error_message TEXT,
    execution_time_ms INTEGER,

    -- ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
    executed_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,

    -- åˆ¶ç´„
    CONSTRAINT chk_tool_status CHECK (status IN ('completed', 'failed'))
);

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_ai_tool_usage_session ON ai_tool_usage(session_id);
CREATE INDEX idx_ai_tool_usage_tool ON ai_tool_usage(tool_name);
CREATE INDEX idx_ai_tool_usage_executed ON ai_tool_usage(executed_at DESC);
```

---

### 7. mcp_serversï¼ˆMCP ã‚µãƒ¼ãƒãƒ¼è¨­å®š - ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

**ç›®çš„**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã® MCP ã‚µãƒ¼ãƒãƒ¼è¨­å®šï¼ˆé«˜åº¦ãªæ©Ÿèƒ½ï¼‰

**MVP ã§ã®æ‰±ã„**: åˆæœŸã¯ä¸è¦ã€‚å¾Œã‹ã‚‰è¿½åŠ å¯èƒ½

```sql
CREATE TABLE mcp_servers (
    -- ãƒ—ãƒ©ã‚¤ãƒžãƒªã‚­ãƒ¼
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),

    -- ãƒ¦ãƒ¼ã‚¶ãƒ¼
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,

    -- MCPã‚µãƒ¼ãƒãƒ¼æƒ…å ±
    name VARCHAR(255) NOT NULL,
    description TEXT,
    base_url VARCHAR(500) NOT NULL,

    -- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
    enabled BOOLEAN DEFAULT true,

    -- çµ±è¨ˆæƒ…å ±
    last_used_at TIMESTAMP,
    usage_count INTEGER DEFAULT 0,

    -- ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,

    -- åˆ¶ç´„
    CONSTRAINT unique_user_mcp_name UNIQUE(user_id, name)
);

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_mcp_servers_user ON mcp_servers(user_id, enabled);
CREATE INDEX idx_mcp_servers_enabled ON mcp_servers(enabled) WHERE enabled = true;

-- ãƒˆãƒªã‚¬ãƒ¼
CREATE TRIGGER update_mcp_servers_updated_at BEFORE UPDATE ON mcp_servers
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();
```

---

### 8. mcp_server_credentialsï¼ˆMCP èªè¨¼æƒ…å ± - ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

**ç›®çš„**: MCP ã‚µãƒ¼ãƒãƒ¼ã®èªè¨¼æƒ…å ±ã‚’æš—å·åŒ–ã—ã¦ä¿å­˜

```sql
CREATE TABLE mcp_server_credentials (
    -- ãƒ—ãƒ©ã‚¤ãƒžãƒªã‚­ãƒ¼
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),

    -- MCPã‚µãƒ¼ãƒãƒ¼
    mcp_server_id UUID NOT NULL UNIQUE REFERENCES mcp_servers(id) ON DELETE CASCADE,

    -- æš—å·åŒ–ã•ã‚ŒãŸèªè¨¼æƒ…å ±
    encrypted_credentials TEXT NOT NULL,
    encryption_key_id VARCHAR(100) NOT NULL,

    -- ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_mcp_credentials_server ON mcp_server_credentials(mcp_server_id);

-- ãƒˆãƒªã‚¬ãƒ¼
CREATE TRIGGER update_mcp_credentials_updated_at BEFORE UPDATE ON mcp_server_credentials
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();
```

---

## ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é †åº

### ãƒ•ã‚§ãƒ¼ã‚º 1: åŸºæœ¬æ©Ÿèƒ½ï¼ˆå¿…é ˆï¼‰

```
000001_create_users_table.up.sql              â† æ—¢å­˜
000002_create_ai_agents_table.up.sql           â† NEWï¼ˆãƒšãƒ«ã‚½ãƒŠçµ±åˆç‰ˆï¼‰
000003_create_conversations_table.up.sql       â† NEWï¼ˆã‚·ãƒ³ãƒ—ãƒ«ç‰ˆï¼‰
000004_create_messages_table.up.sql            â† NEW
```

### ãƒ•ã‚§ãƒ¼ã‚º 2: AI å‡¦ç†å±¥æ­´ï¼ˆæŽ¨å¥¨ï¼‰

```
000005_create_ai_chat_sessions_table.up.sql    â† NEW
000006_create_ai_tool_usage_table.up.sql       â† NEW
```

### ãƒ•ã‚§ãƒ¼ã‚º 3: MCP çµ±åˆï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

```
000007_create_mcp_servers_table.up.sql         â† å¾Œå›žã—
000008_create_mcp_credentials_table.up.sql     â† å¾Œå›žã—
```

---

## å®Ÿè£…ã‚¬ã‚¤ãƒ‰

### 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ãƒ•ãƒ­ãƒ¼

```
Frontend â†’ Backend-go:
  POST /api/v1/auth/signup
  {
    "email": "user@example.com",
    "password": "...",
    "display_name": "å¤ªéƒŽ"
  }

Backend-go:
  1. Cognitoã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²
  2. usersãƒ†ãƒ¼ãƒ–ãƒ«ã«ãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆ

  INSERT INTO users (cognito_user_id, email, display_name)
  VALUES (${cognito_id}, ${email}, ${display_name});
```

### 2. AI Agent ä½œæˆãƒ•ãƒ­ãƒ¼

```
Frontend â†’ Backend-go:
  POST /api/v1/ai-agents
  {
    "name": "ãƒžã‚¤ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ",
    "description": "æ—¥å¸¸æ¥­å‹™ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹AI",
    "persona_type": "assistant",
    "provider": "openai",
    "model": "gpt-4o",
    "temperature": 0.7,
    "max_tokens": 2000
  }

Backend-go:
  INSERT INTO ai_agents (
    user_id,
    name,
    description,
    persona_type,
    provider,
    model,
    temperature,
    max_tokens
  ) VALUES (...);

  Response:
  {
    "id": "...",
    "name": "ãƒžã‚¤ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ",
    "persona_type": "assistant",
    "model": "gpt-4o"
  }
```

### 3. ãƒãƒ£ãƒƒãƒˆé–‹å§‹ãƒ•ãƒ­ãƒ¼

```
Frontend â†’ Backend-go:
  POST /api/v1/conversations
  {
    "ai_agent_id": "..."
  }

Backend-go:
  1. æ—¢å­˜ã®ä¼šè©±ã‚’ãƒã‚§ãƒƒã‚¯
  SELECT id FROM conversations
  WHERE user_id = ${user_id} AND ai_agent_id = ${ai_agent_id};

  2. ãªã‘ã‚Œã°ä½œæˆ
  INSERT INTO conversations (user_id, ai_agent_id)
  VALUES (${user_id}, ${ai_agent_id})
  ON CONFLICT (user_id, ai_agent_id) DO NOTHING
  RETURNING id;

  Response:
  {
    "conversation_id": "...",
    "ai_agent": {...}
  }
```

### 4. ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ãƒ•ãƒ­ãƒ¼

```
Frontend â†’ Backend-go:
  POST /api/v1/chat/send
  {
    "conversation_id": "...",
    "message": "ã“ã‚“ã«ã¡ã¯"
  }

Backend-go:
  1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä¿å­˜
  INSERT INTO messages (conversation_id, sender_type, sender_id, content)
  VALUES (${conv_id}, 'user', ${user_id}, ${message});

  2. ä¼šè©±å±¥æ­´ã‚’å–å¾—
  SELECT sender_type, content, created_at
  FROM messages
  WHERE conversation_id = ${conv_id}
  ORDER BY created_at DESC
  LIMIT 20;

  3. AI Agentè¨­å®šã‚’å–å¾—
  SELECT persona_type, provider, model, temperature, max_tokens, system_prompt
  FROM ai_agents
  WHERE id = ${ai_agent_id};

  4. Backend-pythonã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
  POST http://backend-python:8001/api/v1/chat
  {
    "message": "ã“ã‚“ã«ã¡ã¯",
    "conversation_history": [...],
    "agent_config": {
      "provider": "openai",
      "model": "gpt-4o",
      "persona": "assistant",
      "temperature": 0.7,
      "system_prompt": "ã‚ãªãŸã¯è¦ªåˆ‡ã§ä¸å¯§ãªã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™..."
    }
  }

  5. AIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å—ä¿¡
  {
    "response": "ã“ã‚“ã«ã¡ã¯ï¼ä½•ã‹ãŠæ‰‹ä¼ã„ã§ãã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ",
    "metadata": {
      "tokens_used": 45,
      "processing_time_ms": 850
    }
  }

  6. AIãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä¿å­˜
  INSERT INTO messages (conversation_id, sender_type, sender_id, content, ai_session_id)
  VALUES (${conv_id}, 'ai', ${ai_agent_id}, ${response}, ${session_id});

  7. AIå‡¦ç†å±¥æ­´ã‚’è¨˜éŒ²
  INSERT INTO ai_chat_sessions (
    user_id, conversation_id, ai_agent_id, message_id,
    provider, model, persona, tokens_total, processing_time_ms, status
  ) VALUES (...);

  Response:
  {
    "message_id": "...",
    "content": "ã“ã‚“ã«ã¡ã¯ï¼ä½•ã‹ãŠæ‰‹ä¼ã„ã§ãã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ",
    "created_at": "2025-10-11T..."
  }
```

### 5. ä¼šè©±å±¥æ­´å–å¾—ãƒ•ãƒ­ãƒ¼

```
Frontend â†’ Backend-go:
  GET /api/v1/conversations/:id/messages?limit=50

Backend-go:
  SELECT
    m.id,
    m.sender_type,
    m.sender_id,
    m.content,
    m.created_at,
    CASE
      WHEN m.sender_type = 'user' THEN u.display_name
      WHEN m.sender_type = 'ai' THEN a.name
    END as sender_name
  FROM messages m
  LEFT JOIN users u ON m.sender_type = 'user' AND m.sender_id = u.id
  LEFT JOIN ai_agents a ON m.sender_type = 'ai' AND m.sender_id = a.id
  WHERE m.conversation_id = ${conv_id}
  ORDER BY m.created_at DESC
  LIMIT ${limit};

  Response:
  {
    "messages": [
      {
        "id": "...",
        "sender_type": "ai",
        "sender_name": "ãƒžã‚¤ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ",
        "content": "...",
        "created_at": "..."
      },
      {
        "id": "...",
        "sender_type": "user",
        "sender_name": "å¤ªéƒŽ",
        "content": "...",
        "created_at": "..."
      }
    ]
  }
```

---

## ER å›³ï¼ˆMVP ç‰ˆï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    users     â”‚
â”‚  (ãƒ¦ãƒ¼ã‚¶ãƒ¼)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1:N
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ai_agents   â”‚ â† ãƒšãƒ«ã‚½ãƒŠè¨­å®šã‚’çµ±åˆ
â”‚ (AI Agent)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1:N
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  conversations   â”‚ â† user â†” ai_agent ã®ã¿
â”‚   (ä¼šè©±)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ 1:N
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    messages      â”‚
â”‚  (ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ 1:1
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ai_chat_sessions    â”‚
â”‚  (AIå‡¦ç†ã‚»ãƒƒã‚·ãƒ§ãƒ³)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ 1:N
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ai_tool_usage      â”‚
â”‚  (ãƒ„ãƒ¼ãƒ«ä½¿ç”¨å±¥æ­´)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â€» mcp_servers ã¨ mcp_server_credentials ã¯
  ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆå¾Œã‹ã‚‰è¿½åŠ ï¼‰
```

---

## ãƒ‡ãƒ¼ã‚¿é‡è¦‹ç©ã‚‚ã‚Šï¼ˆMVPï¼‰

### æƒ³å®š: 1,000 ãƒ¦ãƒ¼ã‚¶ãƒ¼ Ã— 3 ãƒ¶æœˆ

| ãƒ†ãƒ¼ãƒ–ãƒ«         | æƒ³å®šãƒ¬ã‚³ãƒ¼ãƒ‰æ•°               | ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ |
| ---------------- | ---------------------------- | ---------- |
| users            | 1,000                        | ~200KB     |
| ai_agents        | 2,000ï¼ˆ1 ãƒ¦ãƒ¼ã‚¶ãƒ¼å¹³å‡ 2 å€‹ï¼‰ | ~400KB     |
| conversations    | 2,000                        | ~400KB     |
| messages         | 100,000ï¼ˆ1 ä¼šè©±å¹³å‡ 50 ä»¶ï¼‰  | ~50MB      |
| ai_chat_sessions | 50,000                       | ~25MB      |
| ai_tool_usage    | 100,000                      | ~50MB      |

**åˆè¨ˆ**: ç´„ 130MBï¼ˆ3 ãƒ¶æœˆé‹ç”¨ï¼‰

---

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### 1. ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡

```sql
-- Backend-goç”¨ãƒ­ãƒ¼ãƒ«ï¼ˆå”¯ä¸€ã®DBã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ï¼‰
CREATE ROLE backend_go_user WITH LOGIN PASSWORD 'secure_password';
GRANT SELECT, INSERT, UPDATE, DELETE ON ALL TABLES IN SCHEMA public TO backend_go_user;
GRANT USAGE, SELECT ON ALL SEQUENCES IN SCHEMA public TO backend_go_user;
```

### 2. è¡Œãƒ¬ãƒ™ãƒ«ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ï¼ˆRLSï¼‰ã®æ¤œè¨Ž

```sql
-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è‡ªåˆ†ã®AI Agentã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
ALTER TABLE ai_agents ENABLE ROW LEVEL SECURITY;

CREATE POLICY ai_agents_user_policy ON ai_agents
    FOR ALL
    TO backend_go_user
    USING (user_id = current_setting('app.current_user_id')::UUID);
```

---

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### å®Ÿè£…é †åº

1. **ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ**ï¼ˆãƒ•ã‚§ãƒ¼ã‚º 1: 4 ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰

   - `000002_create_ai_agents_table.up.sql`
   - `000003_create_conversations_table.up.sql`
   - `000004_create_messages_table.up.sql`

2. **Backend-go å®Ÿè£…**

   - ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«: `ai_agent`, `conversation`, `message`
   - ãƒªãƒã‚¸ãƒˆãƒª: PostgreSQL æŽ¥ç¶š
   - ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹: AI Agent ä½œæˆã€ãƒãƒ£ãƒƒãƒˆé€ä¿¡
   - ãƒãƒ³ãƒ‰ãƒ©ãƒ¼: REST API

3. **Backend-python ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—**

   - DB æŽ¥ç¶šã‚³ãƒ¼ãƒ‰å‰Šé™¤
   - ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹ API åŒ–

4. **Frontend å®Ÿè£…**

   - AI Agent ä½œæˆç”»é¢
   - ãƒãƒ£ãƒƒãƒˆç”»é¢
   - ä¼šè©±å±¥æ­´è¡¨ç¤º

5. **çµ±åˆãƒ†ã‚¹ãƒˆ**

---

## MVP å®Œæˆå¾Œã®æ‹¡å¼µ

### ãƒ•ã‚§ãƒ¼ã‚º 2ï¼ˆå°†æ¥ï¼‰

- ãƒ¦ãƒ¼ã‚¶ãƒ¼é–“ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°ï¼ˆfriendshipsï¼‰
- æ—¢èª­ç®¡ç†ï¼ˆmessage_readsï¼‰
- ã‚°ãƒ«ãƒ¼ãƒ—ãƒãƒ£ãƒƒãƒˆï¼ˆgroups, group_membersï¼‰
- é«˜åº¦ãªãƒšãƒ«ã‚½ãƒŠè¨­å®šï¼ˆai_personas ãƒ†ãƒ¼ãƒ–ãƒ«å¾©æ´»ï¼‰
- çµ±è¨ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆllm_usage_statsï¼‰
- ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥

---

## è£œè¶³: ãƒšãƒ«ã‚½ãƒŠã‚¿ã‚¤ãƒ—ã¨ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ

Backend-go ã§ç®¡ç†ã™ã‚‹ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼š

```go
var DefaultSystemPrompts = map[string]string{
    "assistant": `ã‚ãªãŸã¯è¦ªåˆ‡ã§ä¸å¯§ãªã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•ã«åˆ†ã‹ã‚Šã‚„ã™ãã€ä¸å¯§ã«ç­”ãˆã¦ãã ã•ã„ã€‚
å¿…è¦ã«å¿œã˜ã¦ã€ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—ã§èª¬æ˜Žã—ã¦ãã ã•ã„ã€‚`,

    "creative": `ã‚ãªãŸã¯å‰µé€ çš„ã§ç™ºæƒ³è±Šã‹ãªã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã®å¯¾è©±ã‚’é€šã˜ã¦ã€æ–°ã—ã„ã‚¢ã‚¤ãƒ‡ã‚¢ã‚„è¦–ç‚¹ã‚’æä¾›ã—ã¦ãã ã•ã„ã€‚
æ—¢æˆæ¦‚å¿µã«ã¨ã‚‰ã‚ã‚Œãšã€è‡ªç”±ãªç™ºæƒ³ã‚’å¤§åˆ‡ã«ã—ã¦ãã ã•ã„ã€‚`,

    "analytical": `ã‚ãªãŸã¯è«–ç†çš„ã§åˆ†æžçš„ãªã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚
ãƒ‡ãƒ¼ã‚¿ã¨äº‹å®Ÿã«åŸºã¥ã„ã¦å›žç­”ã—ã€æ ¹æ‹ ã‚’æ˜Žç¢ºã«ç¤ºã—ã¦ãã ã•ã„ã€‚
è¤‡é›‘ãªå•é¡Œã¯è¦ç´ ã«åˆ†è§£ã—ã€ä½“ç³»çš„ã«åˆ†æžã—ã¦ãã ã•ã„ã€‚`,
}
```

ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ `system_prompt` ã‚’æŒ‡å®šã—ãŸå ´åˆã¯ã€ãã¡ã‚‰ã‚’å„ªå…ˆä½¿ç”¨ã€‚
