# AI 開発ワークフロー管理プロンプト

## 概要

このプロンプトは、AI アシスタントが develop ブランチから作業ブランチを作成し、変更を加え、PR を作成してマージするまでの一連のフローを自動的に実行するためのテンプレートです。

---

## 汎用プロンプト

```
# 開発タスク実行依頼

## タスク内容
[ここにタスクの詳細を記述]

## 実行フロー
以下の手順で開発タスクを実行してください：

### 1. 準備
- 現在のgit状態を確認
- developブランチに切り替え
- リモートから最新の変更を取得
- 作業ツリーがクリーンであることを確認

### 2. ブランチ作成
- `docs/CONTRIBUTING.md`のブランチ命名規則に従って新しいブランチを作成
- タイプ: feature/fix/hotfix/refactor/docs/chore
- 形式: `{タイプ}/{番号}-{簡潔な説明}`
- 番号がない場合は省略可能

### 3. 変更の実装
- タスク内容に基づいて必要な変更を実装
- コード品質を保証（リンターエラーなし、型エラーなし）
- セキュリティを考慮
- パフォーマンスを最適化

### 4. コミット
- `docs/CONTRIBUTING.md`のコミットメッセージ規則に従う
- **重要**: 論理的に関連する変更ごとに段階的にコミット
- 1つの大きなコミットではなく、複数の小さなコミットに分割
- 各コミットは以下の形式を使用:
```

{タイプ}({スコープ}): {変更内容の簡潔な説明}

{詳細説明（必要に応じて）}

- 変更点 1
- 変更点 2

```
- タイプ: feat/fix/docs/style/refactor/test/chore/perf/ci
- スコープ: frontend/backend-go/backend-python/database/auth/api/ui/config/docs/deps

### 5. プッシュ
- リモートに作業ブランチをプッシュ
- `-u origin {ブランチ名}` でトラッキング設定

### 6. PR作成
- `gh pr create`コマンドを使用
- タイトル: `[{タイプ}] {変更内容の簡潔な説明}`
- 本文には以下を含める:
- 概要
- 変更内容の詳細
- 影響範囲
- テスト項目
- (必要に応じて) スクリーンショット
- ベースブランチ: develop

### 7. マージ（ユーザーの指示があった場合のみ）
- `gh pr merge {PR番号} --squash --delete-branch`
- developブランチを最新化

## 注意事項
- 各ステップの実行結果を確認してから次のステップに進む
- エラーが発生した場合は適切に対処
- コミットは必ず段階的に分割する（1つの大きなコミットにしない）
- セキュリティ、パフォーマンス、可読性を常に意識する
- `docs/CONTRIBUTING.md`のルールを厳守する
```

---

## 使用例

### 例 1: 新機能追加

```
# 開発タスク実行依頼

## タスク内容
チャット機能にファイル添付機能を追加する。
- 画像ファイル（jpg, png, gif）のアップロード
- ファイルサイズ制限（最大10MB）
- プレビュー表示

## 実行フロー
（上記の汎用プロンプトの手順に従って実行）
```

### 例 2: バグ修正

```
# 開発タスク実行依頼

## タスク内容
ログイン後のリダイレクト先が正しく設定されない問題を修正する。
- 認証成功後、元のページにリダイレクトされるべきだが、常にダッシュボードに遷移してしまう

## 実行フロー
（上記の汎用プロンプトの手順に従って実行）
```

### 例 3: UI 改善

```
# 開発タスク実行依頼

## タスク内容
ローディングUIの配置を全ページで統一する。
- 現在、ページによってローディングスピナーの位置が異なる
- 全て画面中央に統一配置
- モバイル・デスクトップ両対応

## 実行フロー
（上記の汎用プロンプトの手順に従って実行）
```

---

## コミット分割のベストプラクティス

### 良い例（段階的なコミット）

```bash
# 1. ドキュメント追加
git add docs/
git commit -m "docs(frontend): ファイル添付機能のアーキテクチャドキュメントを追加"

# 2. 型定義追加
git add frontend/lib/types/
git commit -m "feat(frontend): ファイル添付用の型定義を追加"

# 3. ユーティリティ関数追加
git add frontend/lib/utils/
git commit -m "feat(frontend): ファイルバリデーションユーティリティを実装"

# 4. APIエンドポイント追加
git add frontend/app/api/
git commit -m "feat(frontend): ファイルアップロードAPIエンドポイントを追加"

# 5. UIコンポーネント追加
git add frontend/components/
git commit -m "feat(frontend): ファイル添付UIコンポーネントを実装"

# 6. 既存機能への統合
git add frontend/components/chat/
git commit -m "feat(frontend): チャット画面にファイル添付機能を統合"
```

### 悪い例（1 つの大きなコミット）

```bash
# 全ての変更を1つのコミットにまとめる（避けるべき）
git add .
git commit -m "feat(frontend): ファイル添付機能を追加"
```

---

## チェックリスト

開発フロー実行前に確認:

- [ ] タスク内容が明確に定義されている
- [ ] 必要な情報が揃っている
- [ ] CONTRIBUTING ルールを理解している

開発フロー実行中に確認:

- [ ] 各コミットが論理的にまとまっている
- [ ] コミットメッセージが規則に従っている
- [ ] リンターエラーがない
- [ ] 型エラーがない

PR 作成前に確認:

- [ ] 全てのコミットが適切に分割されている
- [ ] PR の説明が十分に詳細
- [ ] テスト項目が明記されている
- [ ] セキュリティリスクがない

---

## トラブルシューティング

### git status で untracked files や modified files が残っている

1. `git status`で変更内容を確認
2. 必要な変更か確認
3. 必要であればコミットに追加
4. 不要であれば`git restore`または`git clean`で削除

### コミット後に修正が必要になった

1. 最新のコミットの場合: `git commit --amend`
2. 過去のコミットの場合: `git rebase -i`（注意して使用）
3. リモートに push 済みの場合: 新しいコミットで修正

### ブランチ名を間違えた

1. ローカルのみの場合: `git branch -m {新しい名前}`
2. リモートに push 済みの場合: 新しいブランチを作成し直す

### PR マージ後の後処理

1. `git checkout develop`
2. `git pull origin develop`
3. 不要なローカルブランチを削除: `git branch -d {ブランチ名}`

---

## 高度な使用方法

### 複数の関連タスクを 1 つの PR にまとめる

```
# 開発タスク実行依頼

## タスク内容
認証システムの改善（複数のサブタスク）

### サブタスク1: トークンリフレッシュ機能
- 自動トークンリフレッシュの実装
- ミドルウェアでの期限チェック

### サブタスク2: エラーハンドリング改善
- 認証エラーの適切な処理
- ユーザーフレンドリーなエラーメッセージ

### サブタスク3: ドキュメント更新
- アーキテクチャドキュメントの更新
- ベストプラクティスの追加

## 実行フロー
各サブタスクごとに段階的にコミットを作成し、
1つのPRにまとめる。
```

### 緊急修正（Hotfix）

```
# 開発タスク実行依頼

## タスク内容
【緊急】本番環境でのセキュリティ脆弱性を修正

[詳細]

## 実行フロー
- ブランチタイプ: hotfix/
- 優先度: 最高
- 通常の手順に従うが、レビューを迅速に実施
```

---

## 参考資料

- [CONTRIBUTING.md](./CONTRIBUTING.md): ブランチ命名規則、コミットメッセージ規則
- [GitHub CLI マニュアル](https://cli.github.com/manual/): gh コマンドの詳細
- [Conventional Commits](https://www.conventionalcommits.org/): コミットメッセージの標準

---

## フィードバックと改善

このプロンプトは継続的に改善されます。
問題や改善提案があれば、開発チームに共有してください。
